<!DOCTYPE html><html lang="ar" dir="rtl"><head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>اتحداك - لاعب</title>
<style>
  body{background:#000;color:#fff;font-family:Tahoma;text-align:center;padding:16px}
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;max-width:760px;margin:auto}
  .btn{padding:16px;border:0;border-radius:12px;background:#222;color:#fff;font-size:16px;box-shadow:0 8px 20px #0007}
  .btn:active{transform:scale(.98)}
  .big{padding:20px 16px;font-size:20px;background:#1e88e5}
  .diff{background:#444}
  #status{margin:12px 0;opacity:.95}
  .flash{animation:flash .5s 4}@keyframes flash{0%,100%{background:#1e88e5}50%{background:#0d47a1}}
</style>
</head><body>
  <h1>🎯 لاعب - اتحداك</h1>
  <div id="status">—</div>
  <div id="cats" class="grid"></div>
  <div id="diffs" class="grid" style="margin-top:10px"></div>
  <div style="margin-top:14px">
    <button id="buzzBtn" class="btn big" onclick="buzz()">أنا أجاوب</button>
  </div>

<script src="/socket.io/socket.io.js"></script>
<script>
const role=sessionStorage.getItem('role');
const teamName=sessionStorage.getItem('teamName')||'';
const password=sessionStorage.getItem('password')||'';
if(role!=='player') location.href='/';

const socket=io();
socket.emit('login',{role:'player',teamName,password});
socket.on('loginFail',msg=>alert(msg));
socket.on('loginSuccess',data=>{
  document.getElementById('status').innerText=`فريقك: ${teamName}`;
  renderCats(data.categories);
});
function renderCats(cats=[]){
  document.getElementById('cats').innerHTML=cats.map(c=>`<button class="btn" onclick="pickCat('${c}')">${c}</button>`).join('');
}
function pickCat(cat){
  document.getElementById('diffs').innerHTML=`
    <button class="btn diff" onclick="pickDiff('${cat}','سهل')">سهل</button>
    <button class="btn diff" onclick="pickDiff('${cat}','متوسط')">متوسط</button>
    <button class="btn diff" onclick="pickDiff('${cat}','صعب')">صعب</button>`;
}
function pickDiff(cat,diff){ socket.emit('chooseCategory',{category:cat,difficulty:diff}); }
function buzz(){
  socket.emit('buzz');
  const b=document.getElementById('buzzBtn'); b.classList.add('flash'); setTimeout(()=>b.classList.remove('flash'),2000);
}
socket.on('showQuestionPlayers',q=>{
  document.getElementById('status').innerText=`السؤال: ${q.category} - ${q.difficulty} | اختاره ${q.byTeamName}`;
});
socket.on('roundOpened',()=>{ document.getElementById('buzzBtn').disabled=false; });
socket.on('buzzerLocked',(w)=>{ 
  document.getElementById('buzzBtn').disabled=true; 
  if(w.teamName===teamName) alert('أنت الأسرع!'); 
});
</script>
</body></html>
